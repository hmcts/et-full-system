#!/bin/bash
cd docker/test_server
docker-compose exec et bash -lc "/pd_build/ruby-2.3.7.sh"
docker-compose exec et bash -lc "rvm install ruby-2.3.3 && /usr/local/rvm/bin/rvm-exec ruby-2.3.3@global gem install bundler"
docker-compose exec et bash -lc "rvm install ruby-2.3.3"

docker-compose exec et bash -lc "/pd_build/nodejs.sh"
docker-compose exec et bash -lc "cd /home/app/systems/et1 && bundle install --without=development,test --with=production && RAILS_ENV=local bundle exec rake db:create db:migrate"
docker-compose exec et bash -lc "cd /home/app/systems/et3 && bundle install --without=development,test --with=production && RAILS_ENV=production bundle exec rails db:create db:migrate"
docker-compose exec et bash -lc "cd /home/app/systems/api && bundle install --without=development,test --with=production && RAILS_ENV=production bundle exec rails db:create db:migrate db:seed"
docker-compose exec et bash -lc "cd /home/app/systems/api && RAILS_ENV=production REDIS_DATABASE=2 bundle exec sidekiq &"
docker-compose exec et bash -lc "cd /home/app/systems/admin && bundle install --without=development,test --with=production && RAILS_ENV=production SEED_EXAMPLE_USERS=true bundle exec rails db:seed"




