version: '3'
services:
  test:
    build:
      context: .
    links:
      - selenium
    environment:
      SELENIUM_URL: 'http://selenium:4444/wd/hub'
      DRIVER: chrome
      ADMIN_BASE_URL: "${ADMIN_BASE_URL:-http://admin.et:3100/admin}"
      ATOS_API_URL: "${ATOS_API_URL:-http://api.et:3100/atos_api}"
      ET1_URL: "${ET1_URL:-http://et1.et:3100/}"
      ET3_URL: "${ET3_URL:-http://et3.et:3100/}"
      AWS_ACCESS_KEY_ID: accessKey1
      AWS_SECRET_ACCESS_KEY: verySecretKey1
      AWS_REGION: 'us-east-1'
      AWS_ENDPOINT: 'http://s3.et:3100'
      AWS_S3_FORCE_PATH_STYLE: 'true'
      BUNDLE_WITH: development,test
    volumes:
      - ../../:/app
      - test_gem_cache:/usr/local/bundle
    networks:
      - test_framework
  selenium:
    image: "selenium/standalone-chrome-debug"
    volumes:
      - /dev/shm:/dev/shm
    ports:
      - "${SELENIUM_PORT:-0}:4444"
      - "${SELENIUM_VNC_PORT:-0}:5900"
    networks:
      - test_framework
volumes:
  test_gem_cache:
networks:
  test_framework:
    external:
      name: test_server_et_full_system
